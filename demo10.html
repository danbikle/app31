<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>app31/demo10</title>

    <script src="/src/convnet_init.js"></script>
    <script src="/src/convnet_util.js"></script>
    <script src="/src/convnet_vol.js"></script>
    <script src="/src/convnet_vol_util.js"></script>
    <script src="/src/convnet_layers_dotproducts.js"></script>
    <script src="/src/convnet_layers_pool.js"></script>
    <script src="/src/convnet_layers_input.js"></script>
    <script src="/src/convnet_layers_loss.js"></script>
    <script src="/src/convnet_layers_nonlinearities.js"></script>
    <script src="/src/convnet_layers_dropout.js"></script>
    <script src="/src/convnet_layers_normalization.js"></script>
    <script src="/src/convnet_net.js"></script>
    <script src="/src/convnet_trainers.js"></script>
    <script src="/src/convnet_magicnet.js"></script>
    <script src="/src/convnet_export.js"></script>
    <script src="/jquery.min.js"></script>
    <script src="/codeshow.js"></script>
    <script src="/d3.v3.min.js"></script>
    <script src="/rickshaw.min.js"></script>

    <link href="/css4demos.css" media="all" rel="stylesheet" />

  </head>
  <body>
    <h1>app31/demo10</h1>
    <script>
    var lagn = function(n,my_a) {
      // This function should return array which lags my_a by n.
      // I should get first n members:
      var front_a = my_a.slice(0,n)
      // I should remove last n members:
      var back_a = my_a.slice(0,my_a.length-n) 
      var lagn_a = front_a.concat(back_a)
      return lagn_a
    }
    var lead1 = function(my_a) {
      // This function should return array which leads my_a by 1.
      return my_a.slice(1).concat(my_a[my_a.length-1])
    }
    var pctlagn = function(n,my_a) {
      var pctlagn_a = []
      var lagn_a    = lagn(n,my_a)
      for (i=0; i<my_a.length;i++) {
        pctlagn_a.push(100.0*(my_a[i]-lagn_a[i])/lagn_a[i])
      }
      return pctlagn_a
    }
    var pctlead1 = function(my_a) {
      var pctlead_a = []
      var lead_a    = lead1(my_a)
      for (i=0; i<my_a.length;i++) {
        pctlead_a.push(100.0*(lead_a[i]-my_a[i])/my_a[i])
      }
      return pctlead_a
    }
    // I should use cpasc_a to store dates,prices,pct-deltas
    var cpasc_a  = []
    d3.csv("/csv/GSPC.csv", function(error, csv_a) {
      if (error) throw error
      // Yahoo gives the data by date descending.
      // I should order it    by date ascending.
      csv_a.reverse()
      // I should use two integers to specify my training data:
      var train_end   = csv_a.length - 252 // 1 yr ago
      var train_start = train_end - 252*10 // 10 yrs
      csv_train_a = csv_a.slice(train_start,train_end) 

      // I should get array of closing prices
      var cp_a   = csv_train_a.map(function(row){return +row['Close']})
      var pctlag1 = pctlagn(1,cp_a)
      var pctlag2 = pctlagn(2,cp_a)
      var pctlag4 = pctlagn(4,cp_a)
      var pctlag8 = pctlagn(8,cp_a)
      pctlag8
      var pctlead = pctlead1(cp_a)
      pctlead

      // I should find the median of pctlead in my training data
      train_median    = d3.median(pctlead);
      train_median

      // I should create an array of 2 labels from train_median
      var labels = pctlead.map(function(x){if (x<train_median) return 0 else return 1;})
      labels

    })

    </script>
  </body>
</html>
